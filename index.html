<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClientTracker - Portföy Yönetimi</title>
    
    <!-- Tasarım ve Altyapı Kütüphaneleri (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fontlar -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        
        /* Özel Kaydırma Çubuğu */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Input Stilleri */
        .input-field {
            width: 100%; padding: 0.75rem 1rem; 
            background-color: #f8fafc; border: 1px solid #e2e8f0; 
            border-radius: 0.75rem; font-size: 0.875rem; color: #1e293b; 
            outline: none; transition: all 0.2s;
        }
        .input-field:focus {
            border-color: #6366f1; background-color: #fff; 
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Kayan Yazı Animasyonu */
        @keyframes ticker { 
            0% { transform: translateX(0); } 
            100% { transform: translateX(-50%); } 
        }
        .ticker-wrap {
            width: 100%; overflow: hidden; display: flex;
        }
        .ticker-track {
            display: flex; animation: ticker 40s linear infinite; width: max-content;
        }
        .ticker-track:hover { animation-play-state: paused; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 1. IKONLAR (SVG) ---
        // Lucide React kütüphanesi tarayıcıda doğrudan çalışmadığı için SVG'leri elle tanımlıyoruz.
        const Icon = ({ path, className, size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );

        const Activity = (props) => <Icon {...props} path={<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>} />;
        const TrendingUp = (props) => <Icon {...props} path={<><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></>} />;
        const TrendingDown = (props) => <Icon {...props} path={<><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline><polyline points="17 18 23 18 23 12"></polyline></>} />;
        const Plus = (props) => <Icon {...props} path={<><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></>} />;
        const Trash2 = (props) => <Icon {...props} path={<><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></>} />;
        const Filter = (props) => <Icon {...props} path={<polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>} />;
        const Bell = (props) => <Icon {...props} path={<><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></>} />;
        const Search = (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></>} />;
        const AlertTriangle = (props) => <Icon {...props} path={<><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></>} />;
        const CheckCircle2 = (props) => <Icon {...props} path={<><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m9 12 2 2 4-4"></path></>} />;
        const Newspaper = (props) => <Icon {...props} path={<><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"></path><path d="M18 14h-8"></path><path d="M15 18h-5"></path><path d="M10 6h8"></path></>} />;
        const BarChart2 = (props) => <Icon {...props} path={<><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></>} />;
        const XIcon = (props) => <Icon {...props} path={<><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></>} />;
        const Phone = (props) => <Icon {...props} path={<path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>} />;
        const Printer = (props) => <Icon {...props} path={<><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></>} />;
        const ExternalLink = (props) => <Icon {...props} path={<><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></>} />;
        const CalendarDays = (props) => <Icon {...props} path={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line><path d="M8 14h.01"></path><path d="M12 14h.01"></path><path d="M16 14h.01"></path><path d="M8 18h.01"></path><path d="M12 18h.01"></path><path d="M16 18h.01"></path></>} />;
        const FileText = (props) => <Icon {...props} path={<><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></>} />;
        const BrainCircuit = (props) => <Icon {...props} path={<><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"></path><path d="M9 13a4.5 4.5 0 0 0 3-4"></path><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"></path><path d="M3.477 10.896a4 4 0 0 1 .585-.396"></path><path d="M6 18a4 4 0 0 1-1.967-.516"></path><path d="M12 13h4"></path><path d="M12 18h6a2 2 0 0 1 2 2v1"></path><path d="M12 8h8"></path><path d="M16 8V5a2 2 0 0 1 2-2"></path><circle cx="16" cy="13" r=".5"></circle><circle cx="18" cy="3" r=".5"></circle><circle cx="20" cy="21" r=".5"></circle><circle cx="20" cy="8" r=".5"></circle></>} />;
        const Clock = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></>} />;
        const ChevronRight = (props) => <Icon {...props} path={<polyline points="9 18 15 12 9 6"></polyline>} />;

        // --- 2. VERİLER (Mock Data) ---
        const ECONOMIC_CALENDAR = [
            { id: 1, time: '15:30', currency: 'USD', event: 'Çekirdek Perakende Satışlar', impact: 'high', forecast: '%0.2', previous: '%0.4' },
            { id: 2, time: '15:30', currency: 'USD', event: 'İşsizlik Hak. Yarar. Başv.', impact: 'high', forecast: '215K', previous: '209K' },
            { id: 3, time: '16:15', currency: 'USD', event: 'Sanayi Üretimi (Aylık)', impact: 'medium', forecast: '%0.3', previous: '%-0.6' },
            { id: 4, time: '17:00', currency: 'USD', event: 'İşletme Stokları', impact: 'low', forecast: '%0.1', previous: '%-0.1' },
        ];

        const AI_DAILY_BRIEF = {
            date: new Date().toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }),
            headline: "Piyasa Özeti: Enflasyon Verisi Sonrası Teknoloji Rallisi",
            summary: "Teknoloji hisselerine gelen alımlar, vadeli işlemlerde pozitif seyrin devam edeceğini işaret ediyor. 10 yıllık tahvil faizlerinin %4'ün altına gerilemesi katalizör görevi görüyor.",
            keyPoints: [
                "S&P 500, kritik 4.800 direncini test ediyor.",
                "Apple ve Nvidia öncülüğünde para girişi mevcut.",
                "Petrol fiyatlarındaki çekilme havacılığı destekliyor."
            ],
            strategy: "Volatilite yüksek olabilir. Kısa vadeli 'long' pozisyonlarda kar realizasyonu (TP) seviyelerine sadık kalınmalı."
        };

        const INDICES = [
            { symbol: 'S&P 500', price: 4783.45, change: 0.54 },
            { symbol: 'NASDAQ', price: 15124.80, change: 0.72 },
            { symbol: 'BITCOIN', price: 42850.00, change: -1.24 },
            { symbol: 'GOLD', price: 2045.60, change: 0.32 },
            { symbol: 'BIST 100', price: 8150.20, change: 1.10 },
            { symbol: 'VIX', price: 13.50, change: -2.10 },
            { symbol: 'EUR/USD', price: 1.09, change: -0.15 },
            { symbol: 'BRENT', price: 78.40, change: 0.85 },
        ];

        const INITIAL_POSITIONS = [
            { id: 1, symbol: 'AAPL', account: 'Ahmet Yılmaz', phone: '+905551112233', qty: 10, cost: 175.50, tp: 190, sl: 160, notes: 'Bilanço beklentisi yüksek.' },
            { id: 2, symbol: 'TSLA', account: 'Mehmet Demir', phone: '+905324445566', qty: 5, cost: 240.00, tp: 300, sl: 235, notes: 'Uzun vadeli tutulacak.' },
            { id: 3, symbol: 'NVDA', account: 'Ahmet Yılmaz', phone: '+905551112233', qty: 20, cost: 450.00, tp: 550, sl: 400, notes: 'AI trendi sebebiyle eklendi.' },
            { id: 4, symbol: 'MSFT', account: 'Ayşe Kaya', phone: '+905057778899', qty: 15, cost: 320.00, tp: 380, sl: 300, notes: 'Bulut büyümesi istikrarlı.' },
        ];

        const MOCK_NEWS = [
            { id: 1, symbol: 'AAPL', title: 'Apple Vision Pro satışları beklentiyi aştı', sentiment: 'positive', time: '1s önce', url: 'https://www.google.com/search?q=Apple+Vision+Pro+news' },
            { id: 2, symbol: 'TSLA', title: 'Tesla üretim bandında yavaşlama sinyalleri', sentiment: 'negative', time: '15d önce', url: 'https://www.google.com/search?q=Tesla+production+news' },
            { id: 3, symbol: 'NVDA', title: 'Nvidia yeni AI çipini duyurdu', sentiment: 'positive', time: '2s önce', url: 'https://www.google.com/search?q=Nvidia+AI+chip+news' },
            { id: 4, symbol: 'GENERAL', title: 'FED faiz kararı öncesi piyasalar gergin', sentiment: 'neutral', time: '4s önce', url: 'https://www.google.com/search?q=FED+interest+rate+news' },
        ];

        // --- 3. YARDIMCI FONKSİYONLAR ---
        const getRandomPrice = (basePrice) => {
            const change = (Math.random() - 0.5) * 5; 
            return Math.max(0, basePrice + change);
        };

        // --- 4. ALT BİLEŞENLER ---
        const TradingViewWidget = ({ symbol }) => {
            const container = useRef();
            useEffect(() => {
                if(!container.current) return;
                container.current.innerHTML = ''; 
                const script = document.createElement("script");
                script.src = "https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js";
                script.type = "text/javascript";
                script.async = true;
                script.innerHTML = JSON.stringify({
                    "autosize": true,
                    "symbol": `${symbol}`,
                    "interval": "D",
                    "timezone": "Europe/Istanbul",
                    "theme": "light",
                    "style": "1",
                    "locale": "tr",
                    "enable_publishing": false,
                    "allow_symbol_change": true,
                    "support_host": "https://www.tradingview.com"
                });
                container.current.appendChild(script);
            }, [symbol]);

            return <div className="h-full w-full rounded-xl overflow-hidden bg-slate-50" ref={container}></div>;
        };

        // --- 5. ANA UYGULAMA (APP) ---
        function App() {
            // State Tanımları
            const [positions, setPositions] = useState(INITIAL_POSITIONS);
            const [prices, setPrices] = useState({});
            const [filterAccount, setFilterAccount] = useState('All');
            const [searchQuery, setSearchQuery] = useState('');
            
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isBriefingOpen, setIsBriefingOpen] = useState(false); 
            const [selectedChartSymbol, setSelectedChartSymbol] = useState(null);
            
            const [newPosition, setNewPosition] = useState({ symbol: '', account: '', phone: '', qty: '', cost: '', tp: '', sl: '', notes: '' });
            const [notifications, setNotifications] = useState([]);
            const [showNotifications, setShowNotifications] = useState(false);
            const [alertHistory, setAlertHistory] = useState(new Set()); 
            const [marketIndices, setMarketIndices] = useState(INDICES);

            // Canlı Fiyat Simülasyonu
            useEffect(() => {
                const initialPrices = {};
                positions.forEach(p => { if (!prices[p.symbol]) initialPrices[p.symbol] = p.cost; });
                setPrices(prev => ({...prev, ...initialPrices}));
                
                const interval = setInterval(() => {
                    setPrices(prev => {
                        const next = { ...prev };
                        Object.keys(next).forEach(key => next[key] = getRandomPrice(next[key]));
                        return next;
                    });
                    setMarketIndices(prev => prev.map(idx => ({ ...idx, price: idx.price + (Math.random() - 0.5) * 2 })));
                }, 4000); 
                return () => clearInterval(interval);
            }, [positions]);

            // Uyarı Sistemi
            useEffect(() => {
                positions.forEach(pos => {
                    const currentPrice = prices[pos.symbol];
                    if (!currentPrice) return;
                    
                    // Stop Loss Uyarısı
                    if (pos.sl > 0 && currentPrice <= pos.sl) {
                        const alertKey = `${pos.id}-sl`;
                        if (!alertHistory.has(alertKey)) {
                            addNotification('danger', `${pos.symbol} Stop Loss seviyesini kırdı! (${currentPrice.toFixed(2)})`);
                            setAlertHistory(prev => new Set(prev).add(alertKey));
                        }
                    }
                    // Take Profit Uyarısı
                    if (pos.tp > 0 && currentPrice >= pos.tp) {
                        const alertKey = `${pos.id}-tp`;
                        if (!alertHistory.has(alertKey)) {
                            addNotification('success', `${pos.symbol} Kar Al hedefine ulaştı! (${currentPrice.toFixed(2)})`);
                            setAlertHistory(prev => new Set(prev).add(alertKey));
                        }
                    }
                });
            }, [prices, positions]);

            const addNotification = (type, message) => {
                const newNotif = { id: Date.now(), type, message, time: new Date().toLocaleTimeString() };
                setNotifications(prev => [newNotif, ...prev]);
            };
            const removeNotification = (id) => setNotifications(notifications.filter(n => n.id !== id));
            
            const accounts = useMemo(() => ['All', ...new Set(positions.map(p => p.account))], [positions]);
            
            const filteredPositions = positions.filter(p => {
                const matchesAccount = filterAccount === 'All' || p.account === filterAccount;
                const matchesSearch = p.symbol.toLowerCase().includes(searchQuery.toLowerCase()) || p.account.toLowerCase().includes(searchQuery.toLowerCase());
                return matchesAccount && matchesSearch;
            });

            const totalPortfolioValue = filteredPositions.reduce((sum, p) => sum + (p.qty * (prices[p.symbol] || p.cost)), 0);
            const totalCost = filteredPositions.reduce((sum, p) => sum + (p.qty * p.cost), 0);
            const totalPL = totalPortfolioValue - totalCost;
            const totalPLPercent = totalCost > 0 ? (totalPL / totalCost) * 100 : 0;

            const handleAddPosition = () => {
                if (!newPosition.symbol || !newPosition.qty || !newPosition.cost) return;
                const position = {
                    id: Date.now(),
                    symbol: newPosition.symbol.toUpperCase(),
                    account: newPosition.account || 'Genel',
                    phone: newPosition.phone,
                    qty: Number(newPosition.qty),
                    cost: Number(newPosition.cost),
                    tp: Number(newPosition.tp) || 0,
                    sl: Number(newPosition.sl) || 0,
                    notes: newPosition.notes
                };
                setPositions([...positions, position]);
                setPrices(prev => ({...prev, [position.symbol]: position.cost}));
                setIsModalOpen(false);
                setNewPosition({ symbol: '', account: '', phone: '', qty: '', cost: '', tp: '', sl: '', notes: '' });
            };

            const deletePosition = (id) => setPositions(positions.filter(p => p.id !== id));

            const handlePrintReport = () => {
                const printWindow = window.open('', '', 'height=800,width=800');
                const tableRows = filteredPositions.map(p => {
                    const curr = prices[p.symbol] || p.cost;
                    const total = curr * p.qty;
                    const pl = total - (p.cost * p.qty);
                    return `
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 10px;">${p.account}</td>
                            <td style="padding: 10px;"><strong>${p.symbol}</strong></td>
                            <td style="padding: 10px;">${p.qty}</td>
                            <td style="padding: 10px;">$${p.cost.toFixed(2)}</td>
                            <td style="padding: 10px;">$${curr.toFixed(2)}</td>
                            <td style="padding: 10px; font-weight: bold; color: ${pl >= 0 ? 'green' : 'red'}">$${pl.toFixed(2)}</td>
                            <td style="padding: 10px;">${p.phone || '-'}</td>
                        </tr>`;
                }).join('');
                printWindow.document.write(`
                    <html>
                    <head><title>ClientTracker Rapor</title><style>body{font-family: sans-serif; padding: 20px;} table {width: 100%; border-collapse: collapse;} th {text-align: left; background: #f3f4f6; padding: 10px;} .summary {margin: 20px 0; padding: 15px; background: #f9fafb; border-radius: 8px;}</style></head>
                    <body>
                        <h1>ClientTracker Raporu</h1>
                        <p>${new Date().toLocaleDateString()}</p>
                        <div class="summary"><strong>Toplam Değer:</strong> $${totalPortfolioValue.toLocaleString()} | <strong>Genel K/Z:</strong> %${totalPLPercent.toFixed(2)}</div>
                        <table><thead><tr><th>Müşteri</th><th>Hisse</th><th>Adet</th><th>Maliyet</th><th>Güncel</th><th>K/Z</th><th>Tel</th></tr></thead><tbody>${tableRows}</tbody></table>
                        <script>window.print();<\/script>
                    </body>
                    </html>
                `);
                printWindow.document.close();
            };

            return (
                <div className="min-h-screen bg-slate-50 relative pb-20">
                    
                    {/* Üst Kayan Bant */}
                    <div className="bg-slate-900 text-white text-[11px] font-medium h-9 flex items-center overflow-hidden relative z-40 border-b border-slate-800 shadow-md">
                        <div className="w-full overflow-hidden flex ticker-wrap">
                            <div className="ticker-track">
                                {/* Sonsuz döngü için 2 set veri render ediyoruz */}
                                {[...marketIndices, ...marketIndices].map((idx, index) => (
                                    <div key={index} className="flex items-center mx-6 min-w-max group cursor-default">
                                        <span className="font-bold text-slate-400 group-hover:text-white transition-colors mr-2">{idx.symbol}</span>
                                        <span className="font-mono mr-2">{idx.price.toLocaleString('en-US', { minimumFractionDigits: 2 })}</span>
                                        <span className={`flex items-center ${idx.change >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>
                                            {idx.change >= 0 ? <TrendingUp className="w-3 h-3 mr-1" /> : <TrendingDown className="w-3 h-3 mr-1" />}
                                            %{Math.abs(idx.change).toFixed(2)}
                                        </span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Header */}
                    <header className="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-30 shadow-sm transition-all duration-300">
                        <div className="container mx-auto px-4 md:px-6 h-16 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="bg-indigo-600 text-white p-2 rounded-xl shadow-lg shadow-indigo-200"><Activity size={20} /></div>
                                <div>
                                    <h1 className="text-lg font-bold text-slate-900 leading-none">ClientTracker</h1>
                                    <p className="text-[10px] text-slate-500 font-semibold tracking-wide uppercase mt-0.5">Portföy Yönetimi</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-2 md:gap-4">
                                <button onClick={() => setIsBriefingOpen(true)} className="hidden md:flex items-center gap-2 text-indigo-700 bg-indigo-50 hover:bg-indigo-100 font-semibold text-xs border border-indigo-100 px-3 py-1.5 rounded-full transition-all">
                                    <BrainCircuit size={14} /> AI Bülten
                                </button>
                                
                                <div className="relative">
                                    <button onClick={() => setShowNotifications(!showNotifications)} className="p-2 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-full relative transition-all">
                                        <Bell size={20} />
                                        {notifications.length > 0 && <span className="absolute top-1.5 right-1.5 w-2 h-2 bg-rose-500 rounded-full border border-white"></span>}
                                    </button>
                                    {showNotifications && (
                                        <div className="absolute right-0 top-12 w-72 bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden z-50">
                                            <div className="p-3 border-b border-slate-50 flex justify-between items-center bg-slate-50">
                                                <span className="font-bold text-xs text-slate-700">Bildirimler</span>
                                                {notifications.length > 0 && <button onClick={() => setNotifications([])} className="text-xs text-indigo-600 font-medium">Temizle</button>}
                                            </div>
                                            <div className="max-h-64 overflow-y-auto">
                                                {notifications.length === 0 && <div className="p-6 text-xs text-slate-400 text-center">Bildirim yok.</div>}
                                                {notifications.map(n => (
                                                    <div key={n.id} className="p-3 border-b border-slate-50 hover:bg-slate-50 flex gap-2">
                                                        <div className={`w-1.5 h-1.5 rounded-full mt-1.5 flex-shrink-0 ${n.type === 'danger' ? 'bg-rose-500' : 'bg-emerald-500'}`}></div>
                                                        <div><p className="text-xs font-medium text-slate-700">{n.message}</p><span className="text-[10px] text-slate-400">{n.time}</span></div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <button onClick={handlePrintReport} className="p-2 text-slate-500 hover:text-slate-900 md:hidden"><Printer size={20} /></button>
                                <button onClick={handlePrintReport} className="hidden md:flex items-center gap-2 text-slate-600 font-medium text-xs border border-slate-200 px-3 py-1.5 rounded-lg hover:bg-slate-50 transition-colors"><Printer size={14} /> Raporla</button>
                            </div>
                        </div>
                    </header>

                    {/* Ana İçerik */}
                    <main className="container mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-8">
                        
                        {/* Sol Panel: Portföy */}
                        <div className="lg:col-span-9 space-y-6">
                            
                            {/* Özet ve Filtreler */}
                            <div className="bg-white p-5 rounded-2xl border border-slate-200 shadow-sm flex flex-col md:flex-row justify-between items-center gap-4">
                                <div className="flex-1 w-full md:w-auto text-center md:text-left">
                                    <div className="flex items-center justify-center md:justify-start gap-2 text-slate-400 mb-1">
                                        <Activity size={16} /> <span className="text-xs font-semibold uppercase">Toplam Varlık</span>
                                    </div>
                                    <div className="flex items-baseline justify-center md:justify-start gap-3">
                                        <span className="text-3xl font-bold text-slate-900">${totalPortfolioValue.toLocaleString('en-US', { minimumFractionDigits: 2 })}</span>
                                        <span className={`text-sm font-bold px-2 py-0.5 rounded-md ${totalPL >= 0 ? 'bg-emerald-50 text-emerald-700' : 'bg-rose-50 text-rose-700'}`}>
                                            {totalPL >= 0 ? '+' : ''}{totalPLPercent.toFixed(2)}%
                                        </span>
                                    </div>
                                </div>

                                <div className="flex items-center gap-2 w-full md:w-auto">
                                    <div className="relative flex-1 md:w-64">
                                        <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"><Search size={16} /></span>
                                        <input type="text" placeholder="Ara..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className="input-field pl-10" />
                                    </div>
                                    <div className="relative">
                                        <select value={filterAccount} onChange={(e) => setFilterAccount(e.target.value)} className="bg-slate-50 border-none rounded-xl py-3 pl-3 pr-8 text-sm font-semibold text-slate-600 outline-none appearance-none cursor-pointer hover:bg-slate-100">
                                            {accounts.map(acc => <option key={acc} value={acc}>{acc === 'All' ? 'Tümü' : acc}</option>)}
                                        </select>
                                        <span className="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"><Filter size={12} /></span>
                                    </div>
                                    <button onClick={() => setIsModalOpen(true)} className="bg-slate-900 text-white p-3 rounded-xl shadow-lg hover:bg-slate-800 transition-all active:scale-95"><Plus size={20} /></button>
                                </div>
                            </div>

                            {/* Kartlar */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {filteredPositions.length === 0 ? (
                                    <div className="col-span-full text-center py-20 text-slate-400">
                                        <div className="mx-auto mb-4 bg-slate-100 w-16 h-16 rounded-full flex items-center justify-center"><Search size={32} className="text-slate-300"/></div>
                                        <p>Kriterlere uygun pozisyon bulunamadı.</p>
                                    </div>
                                ) : (
                                    filteredPositions.map(pos => {
                                        const currentPrice = prices[pos.symbol] || pos.cost;
                                        const pl = (currentPrice - pos.cost) * pos.qty;
                                        const plPercent = ((currentPrice - pos.cost) / pos.cost) * 100;
                                        const isProfit = pl >= 0;
                                        const hitTP = pos.tp > 0 && currentPrice >= pos.tp;
                                        const hitSL = pos.sl > 0 && currentPrice <= pos.sl;

                                        return (
                                            <div key={pos.id} className="bg-white rounded-2xl border border-slate-100 p-5 shadow-sm hover:shadow-md transition-all relative overflow-hidden group">
                                                <div className={`absolute top-0 left-0 w-1.5 h-full ${hitTP ? 'bg-emerald-500' : hitSL ? 'bg-rose-500' : 'bg-indigo-500'}`}></div>
                                                <div className="flex justify-between items-start mb-4 pl-3">
                                                    <div>
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <h3 className="text-xl font-bold text-slate-900">{pos.symbol}</h3>
                                                            <span className="text-[10px] font-bold bg-slate-100 text-slate-500 px-2 py-0.5 rounded border border-slate-200">{pos.account}</span>
                                                        </div>
                                                        <p className="text-xs text-slate-400 font-medium">{pos.qty} Lot • Ort: ${pos.cost.toFixed(2)}</p>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-2xl font-bold text-slate-900 font-mono">${currentPrice.toFixed(2)}</div>
                                                        <div className={`text-xs font-bold inline-flex items-center gap-1 px-2 py-0.5 rounded-full ${isProfit ? 'bg-emerald-50 text-emerald-700' : 'bg-rose-50 text-rose-700'}`}>
                                                            {isProfit ? <TrendingUp size={12}/> : <TrendingDown size={12}/>} ${Math.abs(pl).toFixed(2)} (%{plPercent.toFixed(2)})
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="bg-slate-50 rounded-xl p-3 mb-4 pl-4 grid grid-cols-2 gap-4 border border-slate-100">
                                                    <div>
                                                        <span className="text-[10px] uppercase font-bold text-slate-400">Hedef (TP)</span>
                                                        <div className={`font-mono text-sm font-bold flex items-center gap-1 ${hitTP ? 'text-emerald-600' : 'text-slate-700'}`}>
                                                            ${pos.tp || '-'} {hitTP && <CheckCircle2 size={14} className="text-emerald-500"/>}
                                                        </div>
                                                    </div>
                                                    <div className="border-l border-slate-200 pl-4">
                                                        <span className="text-[10px] uppercase font-bold text-slate-400">Stop (SL)</span>
                                                        <div className={`font-mono text-sm font-bold flex items-center gap-1 ${hitSL ? 'text-rose-600' : 'text-slate-700'}`}>
                                                            ${pos.sl || '-'} {hitSL && <AlertTriangle size={14} className="text-rose-500"/>}
                                                        </div>
                                                    </div>
                                                </div>

                                                {pos.notes && <div className="mb-4 pl-4 border-l-2 border-slate-200"><p className="text-xs text-slate-500 italic line-clamp-2 pl-1">"{pos.notes}"</p></div>}

                                                <div className="flex justify-between items-center pl-3 pt-3 border-t border-slate-100">
                                                    <div className="flex gap-2">
                                                        {pos.phone && <a href={`tel:${pos.phone}`} className="flex items-center gap-1 text-xs font-semibold text-slate-600 bg-white border border-slate-200 px-3 py-1.5 rounded-lg hover:border-indigo-400 hover:text-indigo-600 transition-all"><Phone size={14} /> Ara</a>}
                                                        <button onClick={() => setSelectedChartSymbol(pos.symbol)} className="flex items-center gap-1 text-xs font-semibold text-white bg-slate-900 px-3 py-1.5 rounded-lg hover:bg-slate-800 transition-all"><BarChart2 size={14} /> Grafik</button>
                                                    </div>
                                                    <button onClick={() => deletePosition(pos.id)} className="text-slate-400 hover:text-rose-500 p-2"><Trash2 size={18} /></button>
                                                </div>
                                            </div>
                                        );
                                    })
                                )}
                            </div>
                        </div>

                        {/* Sağ Panel: Widgetlar (Ana Ekranda Görünür) */}
                        <div className="lg:col-span-3 space-y-6">
                            
                            {/* AI Analiz Widget */}
                            <div onClick={() => setIsBriefingOpen(true)} className="bg-gradient-to-br from-indigo-600 to-violet-700 rounded-2xl shadow-xl shadow-indigo-200 p-5 text-white cursor-pointer hover:scale-[1.02] transition-transform">
                                <div className="flex justify-between items-center mb-3">
                                    <div className="flex items-center gap-2"><BrainCircuit size={20} className="text-indigo-200"/> <span className="text-xs font-bold uppercase text-indigo-100">AI Analizi</span></div>
                                    <span className="text-[10px] bg-white/20 px-2 py-0.5 rounded">{new Date().toLocaleDateString('tr-TR', {day: 'numeric', month: 'short'})}</span>
                                </div>
                                <h3 className="font-bold text-lg leading-tight mb-2">{AI_DAILY_BRIEF.headline}</h3>
                                <p className="text-xs text-indigo-100 line-clamp-2 mb-3 opacity-90">{AI_DAILY_BRIEF.summary}</p>
                                <div className="flex items-center gap-1 text-xs font-bold text-white/80">Detayları Oku <ChevronRight size={14} /></div>
                            </div>

                            {/* Takvim Widget */}
                            <div className="bg-white rounded-2xl border border-slate-100 shadow-sm p-5">
                                <div className="flex justify-between items-center mb-4"><h3 className="font-bold text-slate-800 text-sm flex items-center gap-2"><Clock size={16} className="text-slate-400"/> Ekonomik Takvim</h3></div>
                                <div className="space-y-3">
                                    {ECONOMIC_CALENDAR.slice(0, 2).map(item => (
                                        <div key={item.id} className="flex gap-3 pb-3 border-b border-slate-50 last:border-0 last:pb-0">
                                            <div className="bg-slate-50 px-2 py-1 rounded text-center min-w-[3rem]"><span className="block text-xs font-bold text-slate-800">{item.time}</span><span className="block text-[10px] text-slate-500 font-bold">{item.currency}</span></div>
                                            <div>
                                                <p className="text-xs font-semibold text-slate-700 line-clamp-1">{item.event}</p>
                                                <div className="flex gap-2 mt-1"><span className={`text-[10px] px-1.5 rounded-sm font-bold uppercase ${item.impact === 'high' ? 'bg-rose-50 text-rose-600' : 'bg-slate-100 text-slate-500'}`}>{item.impact === 'high' ? 'Yüksek' : 'Orta'}</span></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => setIsBriefingOpen(true)} className="w-full mt-3 text-center text-xs font-bold text-indigo-600 hover:text-indigo-800">Tümünü Gör</button>
                            </div>

                            {/* Haberler Widget */}
                            <div className="bg-white rounded-2xl border border-slate-100 shadow-sm p-5">
                                <h2 className="font-bold text-slate-900 flex items-center gap-2 mb-4 pb-2 border-b border-slate-50"><Newspaper size={16} className="text-slate-400"/> Piyasa Haberleri</h2>
                                <div className="space-y-4">
                                    {MOCK_NEWS.map((news, idx) => (
                                        <a key={idx} href={news.url} target="_blank" rel="noopener noreferrer" className="block group">
                                            <div className="flex justify-between items-center mb-1">
                                                <span className="text-[10px] font-bold bg-slate-100 text-slate-600 px-2 py-0.5 rounded-md">{news.symbol}</span>
                                                <span className={`w-1.5 h-1.5 rounded-full ${news.sentiment === 'positive' ? 'bg-emerald-500' : news.sentiment === 'negative' ? 'bg-rose-500' : 'bg-slate-400'}`}></span>
                                            </div>
                                            <h4 className="text-xs font-semibold text-slate-700 group-hover:text-indigo-600 transition-colors mb-1">{news.title}</h4>
                                            <p className="text-[10px] text-slate-400">{news.time}</p>
                                        </a>
                                    ))}
                                </div>
                            </div>

                        </div>
                    </main>

                    {/* MODAL: Yeni Pozisyon */}
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl w-full max-w-lg shadow-2xl overflow-hidden animate-[fadeIn_0.2s_ease-out]">
                                <div className="bg-slate-50 px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                                    <h2 className="font-bold text-slate-800">Yeni Pozisyon</h2>
                                    <button onClick={() => setIsModalOpen(false)}><XIcon size={20} className="text-slate-400 hover:text-slate-600"/></button>
                                </div>
                                <div className="p-6 space-y-4">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="text-xs font-bold text-slate-500 uppercase block mb-1">Sembol</label><input placeholder="Örn: AAPL" className="input-field uppercase font-bold" value={newPosition.symbol} onChange={e => setNewPosition({...newPosition, symbol: e.target.value})}/></div>
                                        <div><label className="text-xs font-bold text-slate-500 uppercase block mb-1">Hesap</label><input placeholder="Örn: Ahmet Bey" className="input-field" value={newPosition.account} onChange={e => setNewPosition({...newPosition, account: e.target.value})}/></div>
                                    </div>
                                    <div><label className="text-xs font-bold text-slate-500 uppercase block mb-1">Telefon</label><input type="tel" placeholder="+90..." className="input-field" value={newPosition.phone} onChange={e => setNewPosition({...newPosition, phone: e.target.value})}/></div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="text-xs font-bold text-slate-500 uppercase block mb-1">Adet</label><input type="number" className="input-field" value={newPosition.qty} onChange={e => setNewPosition({...newPosition, qty: e.target.value})}/></div>
                                        <div><label className="text-xs font-bold text-slate-500 uppercase block mb-1">Maliyet</label><input type="number" className="input-field" value={newPosition.cost} onChange={e => setNewPosition({...newPosition, cost: e.target.value})}/></div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4 p-4 bg-slate-50 rounded-xl border border-slate-100">
                                        <div><label className="text-xs font-bold text-emerald-600 uppercase block mb-1">Hedef (TP)</label><input type="number" className="input-field border-emerald-200 focus:ring-emerald-500" value={newPosition.tp} onChange={e => setNewPosition({...newPosition, tp: e.target.value})}/></div>
                                        <div><label className="text-xs font-bold text-rose-600 uppercase block mb-1">Stop (SL)</label><input type="number" className="input-field border-rose-200 focus:ring-rose-500" value={newPosition.sl} onChange={e => setNewPosition({...newPosition, sl: e.target.value})}/></div>
                                    </div>
                                    <div><label className="text-xs font-bold text-slate-500 uppercase block mb-1">Notlar</label><textarea className="input-field h-20 resize-none" value={newPosition.notes} onChange={e => setNewPosition({...newPosition, notes: e.target.value})}></textarea></div>
                                </div>
                                <div className="px-6 py-4 bg-slate-50 border-t border-slate-100 flex gap-3">
                                    <button onClick={() => setIsModalOpen(false)} className="flex-1 py-2.5 bg-white border border-slate-300 rounded-xl text-slate-700 font-semibold text-sm">İptal</button>
                                    <button onClick={handleAddPosition} className="flex-1 py-2.5 bg-slate-900 text-white rounded-xl font-semibold text-sm hover:bg-slate-800">Kaydet</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL: AI Briefing Detail */}
                    {isBriefingOpen && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-md z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-3xl w-full max-w-4xl h-[85vh] shadow-2xl overflow-hidden flex flex-col animate-[fadeIn_0.2s_ease-out]">
                                <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                    <div><h2 className="text-xl font-bold text-slate-900 flex items-center gap-2"><BrainCircuit className="text-indigo-600"/> AI Piyasa Bülteni</h2><p className="text-xs text-slate-500 mt-1">{AI_DAILY_BRIEF.date}</p></div>
                                    <button onClick={() => setIsBriefingOpen(false)} className="p-2 bg-white border rounded-full hover:bg-rose-50 hover:text-rose-600 transition-colors"><XIcon size={20}/></button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-8">
                                    <div className="grid md:grid-cols-2 gap-8">
                                        <div className="space-y-6">
                                            <div><h3 className="text-2xl font-bold text-slate-900 mb-4">{AI_DAILY_BRIEF.headline}</h3><p className="text-slate-600 leading-relaxed text-lg">{AI_DAILY_BRIEF.summary}</p></div>
                                            <div className="bg-slate-50 p-6 rounded-2xl border border-slate-100"><h4 className="font-bold text-xs uppercase tracking-wider mb-4 text-slate-800">Öne Çıkanlar</h4><ul className="space-y-3">{AI_DAILY_BRIEF.keyPoints.map((pt, i)=><li key={i} className="flex gap-3 text-slate-700 text-sm"><CheckCircle2 size={16} className="text-indigo-500 mt-0.5 flex-shrink-0"/>{pt}</li>)}</ul></div>
                                            <div className="bg-slate-900 text-white p-6 rounded-2xl shadow-lg"><h4 className="font-bold text-indigo-200 text-xs uppercase tracking-wider mb-2">Günün Stratejisi</h4><p className="text-lg font-medium leading-relaxed">"{AI_DAILY_BRIEF.strategy}"</p></div>
                                        </div>
                                        <div>
                                            <div className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                                                <div className="p-4 bg-slate-50 border-b border-slate-200 font-bold text-slate-800 flex items-center gap-2"><Clock size={18} className="text-slate-400"/> Tüm Ekonomik Takvim</div>
                                                <div className="divide-y divide-slate-100">
                                                    {ECONOMIC_CALENDAR.map(item => (
                                                        <div key={item.id} className="p-4 hover:bg-slate-50 flex items-center justify-between">
                                                            <div className="flex items-center gap-4">
                                                                <span className="text-sm font-mono font-bold text-slate-500">{item.time}</span>
                                                                <div><div className="flex items-center gap-2"><span className="text-[10px] font-bold bg-slate-100 px-1.5 rounded border">{item.currency}</span><span className="text-sm font-bold text-slate-800">{item.event}</span></div><div className="text-xs text-slate-500 mt-1 flex gap-3"><span>Beklenti: <strong>{item.forecast}</strong></span><span>Önceki: {item.previous}</span></div></div>
                                                            </div>
                                                            <span className={`text-[10px] font-bold px-2 py-1 rounded uppercase ${item.impact==='high'?'bg-rose-50 text-rose-600 border border-rose-100':'bg-slate-100 text-slate-500'}`}>{item.impact==='high'?'Yüksek':'Orta'}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL: TradingView Chart */}
                    {selectedChartSymbol && (
                        <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl w-full max-w-5xl h-[80vh] shadow-2xl overflow-hidden flex flex-col animate-[fadeIn_0.2s_ease-out]">
                                <div className="p-4 border-b border-slate-200 flex justify-between items-center bg-slate-50">
                                    <h2 className="font-bold text-slate-800 flex items-center gap-2"><BarChart2 className="text-indigo-600"/> {selectedChartSymbol} Analizi</h2>
                                    <button onClick={() => setSelectedChartSymbol(null)}><XIcon size={24} className="text-slate-400 hover:text-rose-600"/></button>
                                </div>
                                <div className="flex-1 bg-slate-100 relative">
                                    <TradingViewWidget symbol={selectedChartSymbol} />
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Toast Notification Container */}
                    <div className="fixed bottom-6 right-6 z-50 flex flex-col gap-3 w-80 pointer-events-none">
                        {notifications.slice(0, 3).map(notif => (
                            <div key={notif.id} className={`pointer-events-auto p-4 rounded-xl shadow-2xl border flex gap-3 items-start animate-[slideInRight_0.3s_ease-out] backdrop-blur-md ${notif.type === 'danger' ? 'bg-white/95 border-rose-100 text-rose-900' : 'bg-white/95 border-emerald-100 text-emerald-900'}`}>
                                <div className={`mt-0.5 p-1 rounded-full ${notif.type === 'danger' ? 'bg-rose-100 text-rose-600' : 'bg-emerald-100 text-emerald-600'}`}>{notif.type === 'danger' ? <AlertTriangle size={16}/> : <CheckCircle2 size={16}/>}</div>
                                <div className="flex-1">
                                    <h4 className="font-bold text-sm">{notif.type === 'danger' ? 'Risk Uyarısı' : 'Hedef Yakalandı'}</h4>
                                    <p className="text-xs mt-1 leading-snug opacity-90">{notif.message}</p>
                                </div>
                                <button onClick={() => removeNotification(notif.id)} className="text-slate-400 hover:text-slate-600"><XIcon size={16}/></button>
                            </div>
                        ))}
                    </div>

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


